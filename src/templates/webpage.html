<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with PySpark</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<div id="chat-container">
    <div id="chatbox">
        <!-- Chat messages will be appended here -->
    </div>
</div>

<div id="input-container">
    <input type="text" id="user_input" placeholder="Type your message here..." onkeypress="return runScript(event)">
    <button id="send_button" onclick="sendMessage()">Send</button>
</div>

<script>
function sendMessage() {
    var user_input = $('#user_input').val();
    if(user_input.trim() === '') return;

    $('#chatbox').append('<div class="message user-message">You: ' + user_input + '</div>');
    $('#user_input').val('');
    $('#chatbox').scrollTop($('#chatbox')[0].scrollHeight);

    $.ajax({
        type: "POST",
        url: "/send_message",
        contentType: "application/json",
        data: JSON.stringify({ message: user_input }),
        success: function(response) {
            $('#chatbox').append('<div class="message bot-message">' + response.message + '</div>');
            $('#chatbox').scrollTop($('#chatbox')[0].scrollHeight);
        },
        error: function() {
            $('#chatbox').append('<div class="message bot-message">Bot: Failed to get a response.</div>');
        }
    });
}

function runScript(e) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        sendMessage();
        return false;
    }
}

// Attach the sendMessage function to button click event
document.getElementById('send_button').onclick = sendMessage;

// Trigger sendMessage function when enter is pressed
document.getElementById('user_input').onkeypress = function(e) {
    if (e.keyCode === 13) {
        sendMessage();
    }
};
</script>

</body>
</html>
